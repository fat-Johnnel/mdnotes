# C++ 迭代器知识笔记

## 1. 什么是迭代器？

* 迭代器是 C++ STL (Standard Template Library) 中的核心概念。
* 它提供了一种**统一的方式**来访问不同容器（如 `vector`, `list`, `set`, `map` 等）中的元素。
* 可以将其视为一个**广义的指针**，指向容器中的元素。
* 与普通指针相比，迭代器提供了更高级的功能和类型安全性，并封装了容器的内部结构。

## 2. 迭代器的作用

* **统一访问接口:** 使得可以使用相同的语法来遍历不同类型的容器。
* **连接算法和容器:** STL 算法通常接受迭代器作为参数，从而可以应用于各种容器。
* **提供灵活的遍历方式:** 支持单向、双向以及随机访问等不同的遍历方式。

## 3. 迭代器的分类 (按功能强弱排序)

| 类型           | 功能                                     | 支持操作                                                                 | 典型应用                                  |
| -------------- | ---------------------------------------- | ------------------------------------------------------------------------ | ----------------------------------------- |
| **输入迭代器** | 只能读取元素 (单向)                      | `*it`, `++it`, `it++`, `it == it2`, `it != it2`                         | `std::istream_iterator`                  |
| **输出迭代器** | 只能写入元素 (单向)                      | `*it = value`, `++it`, `it++`                                          | `std::ostream_iterator`, `std::insert_iterator` |
| **前向迭代器** | 可读写，可多次遍历 (单向)                | 输入和输出迭代器的所有操作                                               | `std::forward_list::iterator`           |
| **双向迭代器** | 可读写，可多次遍历，可双向移动           | 前向迭代器的所有操作, `--it`, `it--`                                     | `std::list::iterator`, `std::set::iterator`, `std::map::iterator` |
| **随机访问迭代器** | 可读写，可多次遍历，可随机访问           | 双向迭代器的所有操作, `it + n`, `it - n`, `it += n`, `it -= n`, `it1 - it2`, `<`, `>`, `<=`, `>=` | `std::vector::iterator`, `std::deque::iterator`, 数组指针 |

## 4. 迭代器的基本操作

* **获取迭代器:**
    * `container.begin()`: 返回指向容器第一个元素的迭代器。
    * `container.end()`: 返回指向容器**尾后 (past-the-end)** 位置的迭代器（不指向任何实际元素）。
    * `container.cbegin()`: 返回指向容器第一个元素的 **const 迭代器** (C++11)。
    * `container.cend()`: 返回指向容器尾后位置的 **const 迭代器** (C++11)。
    * `container.rbegin()`: 返回指向容器最后一个元素的 **反向迭代器**。
    * `container.rend()`: 返回指向容器**首前 (before-the-beginning)** 位置的反向迭代器。

* **迭代器移动:**
    * `++it`: 前置递增，移动到下一个元素。
    * `it++`: 后置递增，移动到下一个元素。
    * `--it`: 前置递减，移动到前一个元素 (双向迭代器及以上)。
    * `it--`: 后置递减，移动到前一个元素 (双向迭代器及以上)。
    * `it + n`, `it - n`: 移动到向前/向后第 `n` 个元素 (随机访问迭代器)。
    * `it += n`, `it -= n`: 将迭代器向前/向后移动 `n` 个位置 (随机访问迭代器)。

* **访问元素:**
    * `*it`: 解引用迭代器，返回迭代器指向的元素的引用。
    * `it->member`: 访问迭代器指向的对象的成员 (如果元素是对象或结构体)。

* **比较迭代器:**
    * `it == it2`, `it != it2`: 比较两个迭代器是否指向同一个位置。
    * `<`, `>`, `<=`, `>=`: 比较两个随机访问迭代器的位置。

## 5. 迭代器的使用示例

```c++
#include <iostream>
#include <vector>
#include <list>
#include <map>

int main() {
    std::vector<int> vec = {1, 2, 3, 4, 5};
    std::list<std::string> lst = {"apple", "banana", "cherry"};
    std::map<std::string, int> mp = {{"Alice", 30}, {"Bob", 25}};

    // 遍历 vector
    std::cout << "Vector elements: ";
    for (std::vector<int>::iterator it = vec.begin(); it != vec.end(); ++it) {
        std::cout << *it << " ";
    }
    std::cout << std::endl;

    // 使用 const_iterator 遍历 list (只读)
    std::cout << "List elements (const): ";
    for (std::list<std::string>::const_iterator cit = lst.cbegin(); cit != lst.cend(); ++cit) {
        std::cout << *cit << " ";
    }
    std::cout << std::endl;

    // 使用范围 for 循环 (底层使用迭代器)
    std::cout << "Map elements: ";
    for (const auto& pair : mp) {
        std::cout << pair.first << ": " << pair.second << " ";
    }
    std::cout << std::endl;

    // 使用反向迭代器遍历 vector
    std::cout << "Vector elements (reverse): ";
    for (std::vector<int>::reverse_iterator rit = vec.rbegin(); rit != vec.rend(); ++rit) {
        std::cout << *rit << " ";
    }
    std::cout << std::endl;

    return 0;
}
```

## 6. 迭代器失效

* 在对容器进行某些操作（如插入或删除元素）后，可能会导致某些迭代器失效。
* **`vector` 和 `deque`:** 插入或删除元素（除了尾部删除 `vector`）可能导致所有迭代器失效。
* **`list`, `forward_list`, `set`, `multiset`, `map`, `multimap`:** 删除元素只会使指向被删除元素的迭代器失效，其他迭代器通常保持有效。插入元素通常不会使已有迭代器失效。
* **使用迭代器时要特别注意容器的修改操作。**

## 7. 总结

* 迭代器是 C++ STL 中用于遍历容器元素的关键工具。
* 它们提供了统一、安全且灵活的访问方式。
* 了解不同类型的迭代器及其功能对于有效地使用 STL 算法至关重要。
* 务必注意迭代器失效的情况，以避免程序错误。
* C++11 引入的 `cbegin()`, `cend()`, `rbegin()`, `rend()` 和范围 for 循环简化了迭代器的使用。